<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <title>Wedding Invitation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/styles.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display&display=swap" rel="stylesheet">
    <link rel="icon" href="/images/favicon.svg" type="image/svg+xml">
</head>
<body>
<!--<div class="wedding-header">-->
<div class="main">
	<div class="flex items-center justify-center">
		<div class="relative animate-on-scroll">
			<div class="video-section">
				<div class="video-container">
					<video class="featured-video" autoplay muted loop>
						<source src="/videos/invitation.mp4" type="video/mp4">
						–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –≤–∏–¥–µ–æ.
					</video>
					<div class="custom-controls">
						<button class="sound-toggle" id="soundToggle">
							<i class="sound-off-icon">üîá</i>
							<i class="sound-on-icon" style="display:none">üîä</i>
						</button>
						<input type="range" id="volumeSlider" class="volume-slider" min="0" max="1" step="0.1" value="0">
					</div>
				</div>
			</div>
			<div class="scroll-down-wrapper">
				<button id="scrollDownBtn" class="scroll-down-btn" aria-label="–ü—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –≤–Ω–∏–∑">
                        <img style="width: 40px; transform: rotate(90deg);" src="/images/arrow.svg" alt="–í–Ω–∏–∑">
                </button>
			</div>
		</div>
	</div>
<!--</div>-->
    <div class="wedding-header">
            <div class="wedding-details animate-on-scroll">
                <h2 class="lead">–î–æ—Ä–æ–≥–∏–µ –¥—Ä—É–∑—å—è –∏ —Ä–æ–¥–Ω—ã–µ!</h2>
                <p>–ú—ã —Ä–∞–¥—ã –ø—Ä–∏–≥–ª–∞—Å–∏—Ç—å –≤–∞—Å —Ä–∞–∑–¥–µ–ª–∏—Ç—å —Å –Ω–∞–º–∏ —Å–∞–º—ã–π –≤–∞–∂–Ω—ã–π –¥–µ–Ω—å –≤ –Ω–∞—à–µ–π –∂–∏–∑–Ω–∏ –∏ –∂–∏–∑–Ω–∏ –Ω–∞—à–∏—Ö –¥–µ—Ç–µ–π.</p>
                <p>–≠—Ç–æ –±—É–¥–µ—Ç –æ—Å–æ–±–µ–Ω–Ω—ã–π –ø—Ä–∞–∑–¥–Ω–∏–∫, –Ω–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π –ª—é–±–æ–≤—å—é, —Ä–∞–¥–æ—Å—Ç—å—é –∏ —Å—á–∞—Å—Ç—å–µ–º, –∞ –∫–∞–∂–¥—ã–π –∏–∑ –≤–∞—Å - –≤–∞–∂–Ω–∞—è –µ–≥–æ
                    —á–∞—Å—Ç—å.</p>
                <p>–ü—É—Å—Ç—å —ç—Ç–æ—Ç –¥–µ–Ω—å –∑–∞–ø–æ–º–Ω–∏—Ç—Å—è —Ç–µ–ø–ª–æ–º, —è—Ä–∫–∏–º–∏ –º–æ–º–µ–Ω—Ç–∞–º–∏ –∏ —Å–º–µ—Ö–æ–º</p>
            </div>
        <div class="wedding-details animate-on-scroll">
            <h2 class="lead">–ú—ã –±—É–¥–µ–º –∂–¥–∞—Ç—å –≤–∞—Å</h2>
            <p>21 —Å–µ–Ω—Ç—è–±—Ä—è 2025 –≥–æ–¥–∞</p>
            <a class="btn-action" href="https://2gis.kg/bishkek/firm/70000001092476183?m=74.5422%2C42.833394%2F16" target="_blank">–†–µ—Å—Ç–æ—Ä–∞–Ω UNO</a>
        </div>
    </div>

    <div class="animate-on-scroll">
        <div class="container-rsvp">
            <div class="rsvp-form" id="rsvpFormContainer">
                <h2 class="text-center mb-4">–ê–Ω–∫–µ—Ç–∞</h2>
                <form th:action="@{/rsvp}" th:object="${guestModel}" method="post" id="rsvpForm">
                    <div class="mb-4">
                        <label for="name" class="form-label">–í–∞—à–µ –∏–º—è –∏ —Ñ–∞–º–∏–ª–∏—è <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="name" th:field="*{name}"
                               required>
                        <div class="invalid-feedback" id="nameError" style="display: none;">–ù–∞–ø–∏—à–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–∞—à–∏ –∏–º—è –∏
                            —Ñ–∞–º–∏–ª–∏—é —Ä—É—Å—Å–∫–∏–º–∏ –±—É–∫–≤–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤)
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç <span class="text-danger">*</span></label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="attending" id="attendingYes"
                                   th:field="*{attending}" th:value="YES" required>
                            <label class="form-check-label" for="attendingYes">
                                –Ø –ø—Ä–∏–¥—É
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="attending" id="attendingPlusOne"
                                   th:field="*{attending}" th:value="PLUS_ONE" required>
                            <label class="form-check-label" for="attendingPlusOne">
                                –Ø –ø—Ä–∏–¥—É —Å–æ –≤—Ç–æ—Ä–æ–π –ø–æ–ª–æ–≤–∏–Ω–∫–æ–π
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="attending" id="attendingNo"
                                   th:field="*{attending}" th:value="NO" required>
                            <label class="form-check-label" for="attendingNo">
                                –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–µ —Å–º–æ–≥—É –ø—Ä–∏–π—Ç–∏
                            </label>
                        </div>
                    </div>
                    <div class="mb-4" id="plusOneNameDiv" style="display: none;">
                        <label for="plusOneName" class="form-label">–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è –≤–∞—à–µ–π –≤—Ç–æ—Ä–æ–π –ø–æ–ª–æ–≤–∏–Ω–∫–∏<span
                                class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="plusOneName" th:field="*{plusOneName}">
                        <div class="invalid-feedback" id="plusOneNameError" style="display: none;">–ù–∞–ø–∏—à–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏–º—è
                            –∏
                            —Ñ–∞–º–∏–ª–∏—é –≤–∞—à–µ–π –≤—Ç–æ—Ä–æ–π –ø–æ–ª–æ–≤–∏–Ω–∫–∏ —Ä—É—Å—Å–∫–∏–º–∏ –±—É–∫–≤–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤)
                        </div>
                    </div>
                    <button type="submit" class="btn-action btn-primary w-100" id="submitButton">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                </form>
            </div>
        </div>
    </div>
</div>
<!--<div class="wedding-bottom">-->
<!--    <div class="wedding-details animate-on-scroll">-->
<!--        <h2 class="lead">–ö—Å—Ç–∞—Ç–∏</h2>-->
<!--        <p>–ú—ã –ª—é–±–∏–º <span style="color: #809671">–î–ï–ù–¨–ì–ò</span> –∏ –Ω–µ –ª—é–±–∏–º —Ü–≤–µ—Ç—ã, –Ω–æ –µ—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å –Ω–∞–º –ø—Ä–∏—è—Ç–Ω–æ, —Ç–æ <span-->
<!--                style="color: var(&#45;&#45;mountain-blue)">–í–ú–ï–°–¢–û</span> —Ü–≤–µ—Ç–æ–≤, –º—ã –±—É–¥–µ–º –æ—á–µ–Ω—å —Ä–∞–¥—ã —á–µ–º—É-–Ω–∏–±—É–¥—å –∏–∑ –Ω–∞—à–µ–≥–æ –≤–∏—à–ª–∏—Å—Ç–∞</p>-->
<!--        <a target="_blank" href="https://followish.io/mywishlist/gulc04s3lbwbmt">-->
<!--            <button class="btn-action">–í–∏—à–ª–∏—Å—Ç</button>-->
<!--        </a>-->
<!--    </div>-->
<!--</div>-->
<footer class="wedding-footer text-center mt-5 mb-3 animate-on-scroll">
    <p class="mb-2" style="font-size: 1.2rem; font-weight: 100; color: var(--mountain-blue);">
        –°–¥–µ–ª–∞–Ω–æ —Å –ª—é–±–æ–≤—å—é, –¥–ª—è –ë–µ–∫–∞ –∏ –≠–ª–Ω—É—Ä—ã üíç
    </p>
    <p style="font-size: 0.9rem;">¬© 2025 –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã</p>

    <button onclick="scrollToTop()" class="btn-action animate-on-scroll">‚Üë –ù–∞–≤–µ—Ä—Ö</button>
</footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>

    document.addEventListener("DOMContentLoaded", function () {
        const video = document.querySelector('.featured-video');
        const soundToggle = document.getElementById('soundToggle');
        const volumeSlider = document.getElementById('volumeSlider');
        const soundOffIcon = document.querySelector('.sound-off-icon');
        const soundOnIcon = document.querySelector('.sound-on-icon');

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –≤–∫–ª—é—á–µ–Ω–∏—è/–≤—ã–∫–ª—é—á–µ–Ω–∏—è –∑–≤—É–∫–∞
        soundToggle.addEventListener('click', function() {
            if (video.muted) {
                video.muted = false;
                soundOffIcon.style.display = 'none';
                soundOnIcon.style.display = 'inline';
                volumeSlider.value = video.volume;
            } else {
                video.muted = true;
                soundOffIcon.style.display = 'inline';
                soundOnIcon.style.display = 'none';
                volumeSlider.value = 0;
            }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Å–ª–∞–π–¥–µ—Ä–∞ –≥—Ä–æ–º–∫–æ—Å—Ç–∏
        volumeSlider.addEventListener('input', function() {
            video.volume = this.value;
            if (this.value > 0) {
                video.muted = false;
                soundOffIcon.style.display = 'none';
                soundOnIcon.style.display = 'inline';
            } else {
                soundOffIcon.style.display = 'inline';
                soundOnIcon.style.display = 'none';
            }
        });

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        if (video.muted) {
            soundOffIcon.style.display = 'inline';
            soundOnIcon.style.display = 'none';
            volumeSlider.value = 0;
        } else {
            soundOffIcon.style.display = 'none';
            soundOnIcon.style.display = 'inline';
            volumeSlider.value = video.volume;
        }

        const observer = new IntersectionObserver(entries => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                    observer.unobserve(entry.target);
                }
            });
        }, {
            threshold: 0.1
        });

        document.querySelectorAll('.animate-on-scroll').forEach(el => {
            observer.observe(el);
        });


        document.querySelectorAll('.animate-on-scroll').forEach(el => {
            observer.observe(el);
        });

        const scrollDownBtn = document.getElementById('scrollDownBtn');
        if (scrollDownBtn) {
            scrollDownBtn.addEventListener('click', () => {
                document.getElementById('rsvpFormContainer')?.scrollIntoView({ behavior: 'smooth' });
            });
        }
    });

    const attendingPlusOne = document.getElementById('attendingPlusOne');
    const attendingYes = document.getElementById('attendingYes');
    const attendingNo = document.getElementById('attendingNo');
    const plusOneNameDiv = document.getElementById('plusOneNameDiv');
    const plusOneNameInput = document.getElementById('plusOneName');
    const form = document.getElementById('rsvpForm');
    const submitButton = document.getElementById('submitButton');
    const nameInput = document.getElementById('name');
    const nameError = document.getElementById('nameError');
    const plusOneInputError = document.getElementById('plusOneNameError');


    function validateName(name) {
        const nameRegex = /^[–ê-–Ø–∞-—è–Å—ë]+ [–ê-–Ø–∞-—è–Å—ë]+( [–ê-–Ø–∞-—è–Å—ë]+)?$/;
        return nameRegex.test(name.trim());
    }

    nameInput.addEventListener('input', function () {
        if (!validateName(this.value)) {
            this.classList.add('is-invalid');
            nameError.style.display = 'block';
        } else {
            this.classList.remove('is-invalid');
            nameError.style.display = 'none';
        }
    });

    nameInput.addEventListener('blur', function () {
        if (!validateName(this.value)) {
            this.classList.add('is-invalid');
            nameError.style.display = 'block';
        }
    });

    plusOneNameInput.addEventListener('input', function () {
        if (attendingPlusOne.checked && !validateName(this.value)) {
            this.classList.add('is-invalid');
            plusOneInputError.style.display = 'block';
        } else {
            this.classList.remove('is-invalid');
            plusOneInputError.style.display = 'none';
        }
    })

    plusOneNameInput.addEventListener('blur', function () {
        if (attendingPlusOne.checked && !validateName(this.value)) {
            this.classList.add('is-invalid');
            plusOneInputError.style.display = 'block';
        }
    })


    function updateFormFields() {
        console.log('updateFormFields called')

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ –¥–ª—è –∏–º–µ–Ω–∏ +1
        if (attendingPlusOne.checked) {
            plusOneNameDiv.style.display = 'block';
            plusOneNameInput.setAttribute('required', 'required');
        } else {
            plusOneNameDiv.style.display = 'none';
            plusOneNameInput.removeAttribute('required');
            if (!attendingPlusOne.checked) {
                plusOneNameInput.value = '';
            }
        }

    }

    // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã
    form.addEventListener('submit', function (e) {
        e.preventDefault();

        if (!validateName(nameInput.value.trim())) {
            return;
        }

        if (attendingPlusOne.checked && !validateName(plusOneNameInput.value.trim())) {
            return;
        }

        if (attendingPlusOne.checked && !plusOneNameInput.value.trim()) {
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∏–º—è +1');
            return;
        }


        submitButton.disabled = true;

        // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
        const formData = new FormData(form);

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º—É —á–µ—Ä–µ–∑ AJAX

        const csrfToken = document.querySelector("meta[name='_csrf']")?.getAttribute("content");
        const csrfHeader = document.querySelector("meta[name='_csrf_header']")?.getAttribute("content");


        fetch(form.action, {
            method: 'POST',
            headers: {
                [csrfHeader]: csrfToken
            },
            body: formData
        })
            .then(response => {
                if (response.ok) {
                    const formElements = form.elements;
                    for (let i = 0; i < formElements.length; i++) {
                        formElements[i].disabled = true;
                    }
                    document.body.style.overflow = 'hidden'
                    const alertDiv = document.createElement('div');
                    alertDiv.className = 'modal';
                    alertDiv.id = 'thankYouModal'
                    alertDiv.role = 'modal';
                    alertDiv.innerHTML = `
                   <div class="modal-content" style="font-family: 'Caveat', cursive">
                            <span class="close" onclick="closeModal()">&times;</span>
                            <p>–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à –æ—Ç–≤–µ—Ç!<br>` + (attendingNo ? `–ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –≤–∞—à–µ —Ä–µ—à–µ–Ω–∏–µ, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –µ—â–µ —Ä–∞–∑` : `–ú—ã –±—É–¥–µ–º —Ä–∞–¥—ã –≤–∏–¥–µ—Ç—å –≤–∞—Å –Ω–∞ –Ω–∞—à–µ–π —Å–≤–∞–¥—å–±–µ!`) +
                        `</p></div>`;
                    document.body.appendChild(alertDiv);

                    // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏

                } else {
                    throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º—ã');
                }
            })
            .catch(error => {
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º—ã. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
                submitButton.disabled = false;
            });
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    updateFormFields();

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞
    document.querySelectorAll('input[name="attending"]').forEach(radio => {
        radio.addEventListener('change', updateFormFields);
    });

    function closeModal() {
        document.getElementById("thankYouModal").style.display = "none";
        document.body.style.overflow = ''
    }

    function scrollToTop() {
        window.scrollTo({top: 0, behavior: 'smooth'});
    }
</script>
</body>
</html>
