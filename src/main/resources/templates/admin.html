<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Админка - Статистика голосования</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<style>
      .stats-card {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: white;
          border-radius: 15px;
      }
      .filter-section {
          background-color: #f8f9fa;
          border-radius: 10px;
          padding: 20px;
          margin-bottom: 20px;
      }
      .table-container {
          background: white;
          border-radius: 10px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }
      .attending-yes { background-color: #d4edda !important; }
      .attending-no { background-color: #f8d7da !important; }
      .attending-plus-one { background-color: #fff3cd !important; }

      /* Мобильная адаптация */
      @media (max-width: 768px) {
          .container-fluid {
              padding-left: 15px;
              padding-right: 15px;
          }

          h1 {
              font-size: 1.5rem;
              text-align: center;
          }

          .stats-card .display-4 {
              font-size: 2rem;
          }

          .filter-section {
              padding: 15px;
          }

          .filter-section .row {
              gap: 15px;
          }

          .filter-section .col-md-6,
          .filter-section .col-md-4,
          .filter-section .col-md-2 {
              width: 100%;
              margin-bottom: 15px;
          }

          .filter-section .d-flex {
              justify-content: center;
              gap: 10px;
          }

          .btn {
              flex: 1;
              max-width: 120px;
          }

          /* Мобильная таблица в виде карточек */
          .table-responsive {
              display: none;
          }

          .mobile-cards {
              display: block;
          }

          .guest-card {
              background: white;
              border-radius: 8px;
              box-shadow: 0 2px 4px rgba(0,0,0,0.1);
              margin-bottom: 15px;
              padding: 15px;
              border-left: 4px solid #667eea;
          }

          .guest-card.attending-yes {
              border-left-color: #28a745;
              background-color: #f8fff9;
          }

          .guest-card.attending-no {
              border-left-color: #dc3545;
              background-color: #fff8f8;
          }

          .guest-card.attending-plus-one {
              border-left-color: #ffc107;
              background-color: #fffdf5;
          }

          .guest-name {
              font-weight: 600;
              font-size: 1.1rem;
              margin-bottom: 8px;
              color: #333;
          }

          .guest-info {
              display: flex;
              flex-direction: column;
              gap: 5px;
          }

          .info-row {
              display: flex;
              justify-content: space-between;
              align-items: center;
              padding: 3px 0;
          }

          .info-label {
              font-weight: 500;
              color: #666;
              font-size: 0.9rem;
          }

          .info-value {
              color: #333;
              font-size: 0.9rem;
          }

          .guest-id {
              position: absolute;
              top: 10px;
              right: 15px;
              background: #667eea;
              color: white;
              padding: 2px 8px;
              border-radius: 12px;
              font-size: 0.8rem;
              font-weight: 500;
          }

          .guest-card {
              position: relative;
          }
      }

      @media (min-width: 769px) {
          .mobile-cards {
              display: none;
          }
      }

      /* Дополнительные мобильные улучшения */
      @media (max-width: 576px) {
          .py-4 {
              padding-top: 1rem !important;
              padding-bottom: 1rem !important;
          }

          .mb-4 {
              margin-bottom: 1.5rem !important;
          }

          .stats-card {
              margin-bottom: 15px;
          }

          .table-container {
              border-radius: 8px;
          }
      }
	</style>
</head>
<body class="bg-light">
<div class="container-fluid py-4">
	<div class="row">
		<div class="col-12">
			<h1 class="mb-4">Админка - Статистика голосования</h1>

			<!-- Статистика -->
			<div class="row mb-4">
				<div class="col-md-6 col-12 mb-3 mb-md-0">
					<div class="card stats-card">
						<div class="card-body text-center">
							<h2 class="display-4" th:text="${totalVoted}">0</h2>
							<p class="mb-0">Всего проголосовало</p>
						</div>
					</div>
				</div>
				<div class="col-md-6 col-12">
					<div class="card stats-card">
						<div class="card-body text-center">
							<h2 class="display-4" th:text="${willCome}">0</h2>
							<p class="mb-0">Придёт гостей</p>
						</div>
					</div>
				</div>
			</div>

			<!-- Фильтры -->
			<div class="filter-section">
				<form method="get" action="/admin">
					<div class="row">
						<div class="col-md-6 col-12 mb-3 mb-md-0">
							<label for="search" class="form-label">Поиск по имени:</label>
							<input type="text"
							       id="search"
							       name="search"
							       class="form-control"
							       placeholder="Введите имя для поиска..."
							       th:value="${search}">
						</div>
						<div class="col-md-4 col-12 mb-3 mb-md-0">
							<label for="attending" class="form-label">Фильтр по статусу:</label>
							<select id="attending" name="attending" class="form-select">
								<option value="">Все</option>
								<option th:each="option : ${attendingOptions}"
								        th:value="${option}"
								        th:text="${option == T(dev.roomwarrior.wedding.enums.AttendingEnum).YES ? 'Придёт' : (option == T(dev.roomwarrior.wedding.enums.AttendingEnum).NO ? 'Не придёт' : 'Придёт с сопровождающим')}"
								        th:selected="${selectedAttending == option}">
								</option>
							</select>
						</div>
						<div class="col-md-2 col-12 d-flex align-items-end justify-content-center justify-content-md-start">
							<button type="submit" class="btn btn-primary me-2">Применить</button>
							<a href="/admin" class="btn btn-outline-secondary">Сброс</a>
						</div>
					</div>
				</form>
			</div>

			<div class="mt-3 mb-3">
				<small class="text-muted">Отображено: <span th:text="${#lists.size(guests)}">0</span> из <span th:text="${totalSize}">0</span> записей</small>
			</div>

			<!-- Таблица гостей (десктоп) -->
			<div class="table-container">
				<div class="table-responsive">
					<table class="table table-hover mb-0">
						<thead class="table-dark">
						<tr>
							<th>ID</th>
							<th>Имя</th>
							<th>Статус</th>
							<th>Сопровождающий</th>
							<th>Дата голосования</th>
						</tr>
						</thead>
						<tbody>
						<tr th:each="guest : ${guests}"
						    th:class="${guest.attending != null ? (guest.attending.name() == 'YES' ? 'attending-yes' : (guest.attending.name() == 'NO' ? 'attending-no' : 'attending-plus-one')) : ''}">
							<td th:text="${guest.id}">1</td>
							<td th:text="${guest.name}">Имя гостя</td>
							<td>
								<span th:if="${guest.attending != null}">
									<span th:if="${guest.attending.name() == 'YES'}">Придёт</span>
									<span th:if="${guest.attending.name() == 'NO'}">Не придёт</span>
									<span th:if="${guest.attending.name() == 'PLUS_ONE'}">С сопровождающим</span>
								</span>
								<span th:if="${guest.attending == null}">-</span>
							</td>
							<td th:text="${guest.plusOneName ?: '-'}">-</td>
							<td th:text="${guest.cts ?: '-'}">-</td>
						</tr>
						<tr th:if="${#lists.isEmpty(guests)}">
							<td colspan="5" class="text-center text-muted">Нет данных для отображения</td>
						</tr>
						</tbody>
					</table>
				</div>

				<!-- Мобильные карточки -->
				<div class="mobile-cards d-block d-md-none">
					<div th:each="guest : ${guests}"
					     th:class="'guest-card ' + (${guest.attending != null ? (guest.attending.name() == 'YES' ? 'attending-yes' : (guest.attending.name() == 'NO' ? 'attending-no' : 'attending-plus-one')) : ''})">
						<div class="guest-id" th:text="${guest.id}">1</div>
						<div class="guest-name" th:text="${guest.name}">Имя гостя</div>
						<div class="guest-info">
							<div class="info-row">
								<span class="info-label">Статус:</span>
								<span class="info-value">
									<span th:if="${guest.attending != null}">
										<span th:if="${guest.attending.name() == 'YES'}">Придёт</span>
										<span th:if="${guest.attending.name() == 'NO'}">Не придёт</span>
										<span th:if="${guest.attending.name() == 'PLUS_ONE'}">С сопровождающим</span>
									</span>
									<span th:if="${guest.attending == null}">-</span>
								</span>
							</div>
							<div class="info-row" th:if="${guest.plusOneName}">
								<span class="info-label">Сопровождающий:</span>
								<span class="info-value" th:text="${guest.plusOneName}">-</span>
							</div>
							<div class="info-row" th:if="${guest.cts}">
								<span class="info-label">Дата голосования:</span>
								<span class="info-value" th:text="${guest.cts}">-</span>
							</div>
						</div>
					</div>
					<div th:if="${#lists.isEmpty(guests)}" class="text-center text-muted p-4">
						Нет данных для отображения
					</div>
				</div>
			</div>


		</div>
	</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
